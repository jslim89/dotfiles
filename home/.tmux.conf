# To reload the configuration file after modification
# $ tmux source-file ~/.tmux.conf

# change the modifier key to backtick
# if you're using ms natural keyboard 4000
unbind C-b
set-option -g prefix `

# missing this you can't type backtick
# @see http://superuser.com/a/397712
bind-key -r ` send-prefix

# window navigation
bind-key -n M-j prev
bind-key -n M-k next

# switch split window keys
# @see http://askubuntu.com/q/173174
# @see http://rdegges.com/tools-i-use-tmux
unbind %
bind-key | split-window -h -c '#{pane_current_path}'
bind-key \\ split-window -h -c '#{pane_current_path}'
bind-key - split-window -v -c '#{pane_current_path}'

# search & switch session
#bind-key C-j choose-tree
bind C-j split-window -v "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"
bind-key K run-shell 'tmux switch-client -n \; kill-sessin -t "$(tmux display-message -p "#S")" || tmux kill-session'

# new window
bind c new-window -c '#{pane_current_path}'

# use vim keys to switch between plane
# @see http://alexyoung.org/2011/12/19/build-an-ide-with-tmux-and-vim/
set-window-option -g mode-keys vi
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?)(diff)?$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1  ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1  ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
bind-key -T copy-mode-vi v send-keys -X begin-selection

# resize pane
bind-key -n S-Left resize-pane -L 2
bind-key -n S-Right resize-pane -R 2
bind-key -n S-Down resize-pane -D 1
bind-key -n S-Up resize-pane -U 1

bind-key -n C-Left resize-pane -L 10
bind-key -n C-Right resize-pane -R 10
bind-key -n C-Down resize-pane -D 5
bind-key -n C-Up resize-pane -U 5

# join-pane/break-pane/swap-pane
bind-key j command-prompt -p "join pane from: " "join-pane -h -s '%%'"
bind-key b break-pane -d
bind-key s display-panes\; command-prompt -p "pane #: " "swap-pane -t '%%'"

# prompted session
bind-key n command-prompt -p "new session: " "new -s '%%'"

# theme
set -g status-keys "emacs"
set -g status-justify right
set -g status-interval 5
set -g status-left-length 30
set -g visual-activity on
set-window-option -g monitor-activity on

# title
# @see https://gist.github.com/wyattdanger/1142359
setw -g automatic-rename off
set-option -g set-titles on
set-option -g set-titles-string '#I:#W @#T'

# clock
set-window-option -g clock-mode-colour cyan
set-window-option -g clock-mode-style 24

# No zero-based index
set-option -g base-index 1
set-option -g renumber-windows on

# Open a man page in new window
# @see http://askubuntu.com/q/173174
bind-key / command-prompt "split-window 'exec man %%'"

# quick view of processes
# @see http://askubuntu.com/q/173174
bind-key '~' split-window "exec htop"

# Reload tmux.conf
# @see http://www.linuxized.com/2010/05/switching-from-gnu-screen-to-tmux/
bind-key r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"

# Almost unlimited history
# @see http://www.tjvanslyke.com/2012/07/01/tmux-for-vim-users.html
set-option -g history-limit 100000

# Enable Shift+PgUp to scroll back previous page
# @see http://superuser.com/a/314620
set -g terminal-overrides 'xterm*:smcup@:rmcup@'

## Plugins ##
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'

# nord theme: https://github.com/arcticicestudio/nord-tmux
set -g @plugin "arcticicestudio/nord-tmux"
set -g @nord_tmux_no_patched_font "1"
set -g @nord_tmux_show_status_content "1"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b "~/.tmux/plugins/tpm/tpm"
